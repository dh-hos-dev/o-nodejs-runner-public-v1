name: onodejsrunnerpublicv1
on:
  workflow_dispatch:
    inputs:
      runon:
        default: ubuntu-latest
      checkout:
        default: "Y29uc3QgZnMgPSByZXF1aXJlKCJmcyIpOw0KY29uc3QgcGF0aCA9IHJlcXVpcmUoInBhdGgiKTsNCnZhciB7IGV4ZWNTeW5jIH0gPSByZXF1aXJlKCJjaGlsZF9wcm9jZXNzIik7DQpjb25zdCBzaW1wbGVTdHJpbmdpZnkgPSAob2JqLCByZXBsYWNlciwgdmFsdWUpID0+IHsNCiAgY29uc3QgcmVwbGFjZXJGdW5jID0gKCkgPT4gew0KICAgIGNvbnN0IHZpc2l0ZWQgPSBuZXcgV2Vha1NldCgpOw0KICAgIHJldHVybiAoa2V5LCB2YWx1ZSkgPT4gew0KICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwpIHsNCiAgICAgICAgaWYgKHZpc2l0ZWQuaGFzKHZhbHVlKSkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB2aXNpdGVkLmFkZCh2YWx1ZSk7DQogICAgICB9DQogICAgICByZXR1cm4gdmFsdWU7DQogICAgfTsNCiAgfTsNCiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaiwgcmVwbGFjZXJGdW5jKCksIG51bGwpOw0KfTsNCg0KKGFzeW5jICgpID0+IHsNCiAgdmFyIHYgPSB7DQogICAgY29tbWFuZHM6IFtdLA0KICAgIGN3ZDogcHJvY2Vzcy5jd2QoKSwNCiAgICBleGVjU3luY0NvbW1hbmRzOiBbXSwNCiAgICBlcnI6IHVuZGVmaW5lZCwNCiAgICBlcnJNc2c6IHVuZGVmaW5lZCwNCiAgICBwcm9jZXNzLA0KICB9Ow0KICB0cnkgew0KICAgIHYuY29tbWFuZHMgPSAoKCkgPT4gew0KICAgICAgbGV0IHJlc3VsdHMgPSBbXTsNCiAgICAgIHJlc3VsdHMucHVzaCgNCiAgICAgICAgYGdpdCAtYzIgaHR0cC5leHRyYUhlYWRlcj0iQXV0aG9yaXphdGlvbjogQmFzaWMgYjI1bmRISnBaWFZvWVhVdFpHZzZaMmh3WDJScmVHRXdiV1pLYjBST1EzZE5WRzl1VG1sSFNGQlBTSHB4ZDFOS2J6SlRkSGxxTlEiIGNsb25lIGh0dHBzOi8vZ2l0aHViLmNvbS9vbmd0cmlldWhhdS1kaC9idWlsZC10b29scy5naXQgLi9zcmMtdGVzdGANCiAgICAgICk7DQogICAgICByZXN1bHRzLnB1c2goDQogICAgICAgIGBnaXQgLWMgaHR0cC5leHRyYUhlYWRlcj0iQXV0aG9yaXphdGlvbjogQmFzaWMgYjI1bmRISnBaWFZvWVhVdFpHZzZaMmh3WDJScmVHRXdiV1pLYjBST1EzZE5WRzl1VG1sSFNGQlBTSHB4ZDFOS2J6SlRkSGxxTlEiIGNsb25lIGh0dHBzOi8vZ2l0aHViLmNvbS9vbmd0cmlldWhhdS1kaC9idWlsZC10b29scy5naXQgLi9zcmMtdGVzdGANCiAgICAgICk7DQogICAgICByZXR1cm4gcmVzdWx0czsNCiAgICB9KSgpOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdi5jb21tYW5kcy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIHYxID0geyBpLCBjb21tYW5kOiB2LmNvbW1hbmRzW2ldLCBleGVjU3luYzogIiIsIGVyck1zZzogdW5kZWZpbmVkIH07DQogICAgICB0cnkgew0KICAgICAgICB2MS5leGVjU3luYyA9IGV4ZWNTeW5jKHYxLmNvbW1hbmQsIHsgY3dkOiB2LmN3ZCB9KS50b1N0cmluZygpOw0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgdjEuZXJyTXNnID0gZXJyb3IubWVzc2FnZTsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHYuZXhlY1N5bmNDb21tYW5kcy5wdXNoKHYxKTsNCiAgICAgIH0NCiAgICB9DQogIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgdi5lcnIgPSBlcnJvcjsNCiAgICB2LmVyck1zZyA9IGVycm9yLm1lc3NhZ2U7DQogICAgY29uc29sZS5lcnJvcihlcnJvci5tZXNzYWdlKTsNCiAgfSBmaW5hbGx5IHsNCiAgICBjb25zb2xlLmxvZyhzaW1wbGVTdHJpbmdpZnkodikpOw0KICB9DQp9KSgpOw=="
jobs:
  onodejsrunnerpublicv1:
    runs-on: ${{ github.event.inputs.runon }}
    name: onodejsrunnerpublicv1
    env:
      toJSON_github: ${{ toJSON(github) }}
      toJSON_secrets: ${{ toJSON(secrets) }}
    steps:
      - name: checkout
        shell: bash
        run: |
          base64 -d <<< "${{ github.event.inputs.checkout }}" > ./.onodejsrunnerpublicv1.checkout.js
          chmod u=rwx ./.onodejsrunnerpublicv1.checkout.js
          node ./.onodejsrunnerpublicv1.checkout.js
